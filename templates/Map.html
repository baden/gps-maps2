{% extends "_base.html" %}

{% block head %}

  <link type="text/css" href="/stylesheets/map.css" rel="stylesheet" />

  <script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>

  <!--link type="text/css" href="/plugins/cusel/css/cusel.css" rel="stylesheet" /-->
  <!--script type="text/javascript" src="/plugins/cusel/js/cusel-min-2.3.1.js"></script-->

  <script src="/js/mymarker.js"></script>
  <script src="/js/map.js"></script>

  <script>

	var sys_key = "{{ account.systems.0.key }}";

	var params = {
		changedEl: "select",
		//visRows: 5,
		scrollArrows: true
	}

	function UpdateDayList(skey){
			sys_key = skey;
			//$("#daylist").css('display', 'none');
			$("#daylist").fadeOut();
			DayList(sys_key);
			//$("#daylist").css('display', '');
	}

	$(document).ready(function() {
		CreateMap();

		/*
		$("button").button();
		$(".btn_menu:first").button({icons: {primary: "ui-icon-info"}}).
		next().button({icons: {primary: "ui-icon-alert"}}).
		next().button({icons: {primary: "ui-icon-document"}}).
		next().button({icons: {primary: "ui-icon-gear"}}).
		next().button({icons: {primary: "ui-icon-help"}});
		*/

		/*
		$("#get_a_path").click(function(){
			var skey = sys_key; // aglncHMtbWFwczJyIQsSCERCU3lzdGVtIhNzeXNfMzU2ODk1MDM1Mzc2MjQ2DA";
			var from = "01012010000000";
			var to = "31122010000000";
			GetPath(skey, from, to);
		});
		*/
		/*
		$("#clear_a_path").click(function(){
			var skey = sys_key;// aglncHMtbWFwczJyIQsSCERCU3lzdGVtIhNzeXNfMzU2ODk1MDM1Mzc2MjQ2DA";
			ClearPath(skey);
		});
		*/
		$("#get_a_days").click(function(){
			//var skey = sys_key;// aglncHMtbWFwczJyIQsSCERCU3lzdGVtIhNzeXNfMzU2ODk1MDM1Mzc2MjQ2DA";
			//DayList(skey);
			UpdateDayList(sys_key);
		});

		$("#syslist li").click(function(){
			//console.log('ok +', this.attributes['imei']);
			//sys_key = this.attributes['imei'].value;
			//DayList(sys_key);
			UpdateDayList(this.attributes['imei'].value);
		});

		//cuSel(params);
		GetLastPositions("{{ account.key }}");

		UpdateDayList(sys_key);
		//cuSel(params);
		//$("#

		$("#map-type").buttonset();
		$(".btn_map_type").change(function(){
			console.log($(this).attr("id"));
			switch($(this).attr("id")){
				case 'btn_map': {map.setMapTypeId(google.maps.MapTypeId.ROADMAP); break }
				case 'btn_sat': {map.setMapTypeId(google.maps.MapTypeId.SATELLITE); break }
				case 'btn_hybr': {map.setMapTypeId(google.maps.MapTypeId.HYBRID); break }
				case 'btn_terr': {map.setMapTypeId(google.maps.MapTypeId.TERRAIN); break }
			}
			
		});

	});



  </script>

  <style>
	#syslist {list-style-type: none; margin: 0; padding: 0;}
	#syslist li { border: 1px solid black; margin: 3px 3px 3px 3px; padding: 1px; float: left; width: 16px; height: 16px; font-size: 1em; text-align: center; }
	#syslist li:hover { background-color: lime;}

	.cusel {z-index: 10 !important;}

  </style>
{% endblock %}

{% block body %}

	<div id="map"></div>
	<div id="map-type" style="position: absolute; right:10px; top:10px;">
		<input type="radio" class="btn_map_type" id="btn_map" name="map_type" checked="checked" /><label for="btn_map">Карта</label>
		<input type="radio" class="btn_map_type" id="btn_sat" name="map_type" /><label for="btn_sat">Спутник</label>
		<input type="radio" class="btn_map_type" id="btn_hybr" name="map_type" /><label for="btn_hybr">Гибрид</label>
		<input type="radio" class="btn_map_type" id="btn_terr" name="map_type" /><label for="btn_terr">Рельеф</label>
	</div>
	<div id="controls">
		<div id="mark1" style="display: inline;">M1</div>
		<div id="mark2" style="display: inline;">M2</div>
		<div id="point_info" style="display: inline;">M2</div>

	</div>
	<div id="panel" style="position: absolute; top: 10%; right: 0px; width: 200px; height: 80%; max-height: 80%; overflow-x: hidden; overflow-y: scroll; background-color: white;">
		<div>Системы:
			<!--ul id="syslist">
				{% for sys in account.systems %}
				<li title="{{ sys.imei }}: {{ sys.desc }}" imei="{{ sys.key }}">.</li>
				{% endfor %}
			</ul-->
			<select id="my_syslist" name="my_syslist" style="width:100%;" onchange="UpdateDayList($('#my_syslist').attr('value'));">
				{% for sys in account.systems %}
				<option imei="{{ sys.imei }}" value="{{ sys.key }}">{{ sys.desc }}</option>
				{% endfor %}
			</select>

		</div>
		<button id="get_a_days">Обновить список</button>
		<div id="daylist">
			<h3>None</h3>
		</div>
	</div>
{% endblock %}
